const cluster = require('cluster');
const http = require('http');
const numCPUs = require('os').cpus().length;


// Running 10s test @ http://localhost:8080
// 10 connections
// ┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬──────────┐
// │ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max      │
// ├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼──────────┤
// │ Latency │ 0 ms │ 0 ms │ 0 ms  │ 0 ms │ 0.01 ms │ 0.14 ms │ 22.03 ms │
// └─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴──────────┘
// ┌───────────┬─────────┬─────────┬─────────┬────────┬──────────┬─────────┬─────────┐
// │ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%  │ Avg      │ Stdev   │ Min     │
// ├───────────┼─────────┼─────────┼─────────┼────────┼──────────┼─────────┼─────────┤
// │ Req/Sec   │ 34655   │ 34655   │ 49151   │ 49599  │ 47626.19 │ 4152.72 │ 34637   │
// ├───────────┼─────────┼─────────┼─────────┼────────┼──────────┼─────────┼─────────┤
// │ Bytes/Sec │ 4.54 MB │ 4.54 MB │ 6.44 MB │ 6.5 MB │ 6.24 MB  │ 544 kB  │ 4.54 MB │
// └───────────┴─────────┴─────────┴─────────┴────────┴──────────┴─────────┴─────────┘

// Req/Bytes counts sampled once per second.
// 524k requests in 11.07s, 68.6 MB read

if (cluster.isMaster) {
  for (let i = 0; i < numCPUs; i++) {
    cluster.fork();
  }
} else {
  http.createServer((req, res) => {
    res.writeHead(200);
    res.end('hello world!!');
  }).listen(8080);
}
